<?xml version="1.0" encoding="utf-8"?><asx:abap version="1.0" xmlns:asx="http://www.sap.com/abapxml"><asx:values><VERSION>1</VERSION><TYPE/><INTERFACE href="#o3582"/><INTERFACET><FPINTERFACET><NAME/><STATE/><LANGUAGE>D</LANGUAGE><ID/><TEXT>Schnittstelle für Druck von Fakturabelegen</TEXT></FPINTERFACET><FPINTERFACET><NAME/><STATE/><LANGUAGE>E</LANGUAGE><ID/><TEXT>Interface for Printing Billing Documents</TEXT></FPINTERFACET><FPINTERFACET><NAME/><STATE/><LANGUAGE>S</LANGUAGE><ID/><TEXT>Interfase para imprimir documentos de facturación</TEXT></FPINTERFACET></INTERFACET></asx:values><asx:heap xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:abap="http://www.sap.com/abapxml/types/built-in" xmlns:cls="http://www.sap.com/abapxml/classes/global" xmlns:dic="http://www.sap.com/abapxml/types/dictionary"><cls:CL_FP_INTERFACE_DATA id="o3582"><CL_FP_INTERFACE_DATA classVersion="1"><CODING href="#o3578"/><PARAMETERS href="#o3579"/><GLOBAL_DEFINITIONS href="#o3580"/><REFERENCE_FIELDS href="#o3581"/><XSD_DEFINITIONS/></CL_FP_INTERFACE_DATA></cls:CL_FP_INTERFACE_DATA><cls:CL_FP_REFERENCE_FIELDS id="o3581"><CL_FP_INTERFACE_DATA_CHANGED classVersion="1"><INTERFACE_DATA href="#o3582"/></CL_FP_INTERFACE_DATA_CHANGED><CL_FP_REFERENCE_FIELDS classVersion="1"><REFERENCE_FIELDS><SFPREF><ACTIVE/><STANDARD/><DATATYPE>CURR</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-VBDKR-NETWR</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-VBDKR-WAERK</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>QUAN</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-VBDKR-BRGEW</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-VBDKR-GEWEI</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>QUAN</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-VBDKR-NTGEW</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-VBDKR-GEWEI</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>QUAN</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-VBDKR-VOLUM</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-VBDKR-VOLEH</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>CURR</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-CONDITIONS-KWERT</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-VBDKR-WAERK</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>CURR</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-CONDITIONS-KBETR</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-CONDITIONS-KOEI1</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>CURR</DATATYPE><VALUE>BIL_PRT_COM-ITEM_DETAIL-CONDITIONS-KBETR</VALUE><UNIT>BIL_PRT_COM-ITEM_DETAIL-CONDITIONS-KOEI1</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>CURR</DATATYPE><VALUE>BIL_PRT_COM-ITEM_DETAIL-CONDITIONS-KWERT</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-VBDKR-WAERK</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>QUAN</DATATYPE><VALUE>BIL_PRT_COM-ITEM_DETAIL-CONDITIONS-NRMNG</VALUE><UNIT>BIL_PRT_COM-ITEM_DETAIL-CONDITIONS-KMEIN</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>QUAN</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-CONDITIONS-NRMNG</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-CONDITIONS-KMEIN</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>CURR</DATATYPE><VALUE>BIL_PRT_COM-ITEM_DETAIL-CONDITIONS-KAWRT</VALUE><UNIT>BIL_PRT_COM-ITEM_DETAIL-CONDITIONS-AWEI1</UNIT></SFPREF><SFPREF><ACTIVE/><STANDARD/><DATATYPE>CURR</DATATYPE><VALUE>BIL_PRT_COM-HEAD_DETAIL-CONDITIONS-KAWRT</VALUE><UNIT>BIL_PRT_COM-HEAD_DETAIL-CONDITIONS-AWEI1</UNIT></SFPREF></REFERENCE_FIELDS></CL_FP_REFERENCE_FIELDS></cls:CL_FP_REFERENCE_FIELDS><cls:CL_FP_GLOBAL_DEFINITIONS id="o3580"><CL_FP_INTERFACE_DATA_CHANGED classVersion="1"><INTERFACE_DATA href="#o3582"/></CL_FP_INTERFACE_DATA_CHANGED><CL_FP_GLOBAL_DEFINITIONS classVersion="1"><GLOBAL_DATA><SFPGDATA><NAME>GV_OCULTAR_IVA</NAME><TYPING>TYPE</TYPING><TYPENAME>FLAG</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GT_DETALLE</NAME><TYPING>TYPE</TYPING><TYPENAME>GTT_DETALLE</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GS_DATA</NAME><TYPING>TYPE</TYPING><TYPENAME>GTY_DATA</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_LOGO</NAME><TYPING>TYPE</TYPING><TYPENAME>XSTRING</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_NAME</NAME><TYPING>TYPE</TYPING><TYPENAME>STXBITMAPS-TDNAME</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_OBJECT</NAME><TYPING>TYPE</TYPING><TYPENAME>TDOBJECTGR</TYPENAME><DEFAULTVAL>'GRAPHICS'</DEFAULTVAL><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_ID</NAME><TYPING>TYPE</TYPING><TYPENAME>TDIDGR</TYPENAME><DEFAULTVAL>'BMAP'</DEFAULTVAL><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_BTYPE</NAME><TYPING>TYPE</TYPING><TYPENAME>TDBTYPE</TYPENAME><DEFAULTVAL>'BCOL'</DEFAULTVAL><CONSTANT/></SFPGDATA><SFPGDATA><NAME>ULINE</NAME><TYPING>TYPE</TYPING><TYPENAME>TDD_PRINT_ULINE</TYPENAME><DEFAULTVAL>'______________________________________________________________________________________________________________________________'</DEFAULTVAL><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_FACAM</NAME><TYPING>TYPE</TYPING><TYPENAME>FLAG</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_ITP</NAME><TYPING>TYPE</TYPING><TYPENAME>DMBTR</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_IVA</NAME><TYPING>TYPE</TYPING><TYPENAME>DMBTR</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_SIN_IVA</NAME><TYPING>TYPE</TYPING><TYPENAME>DMBTR</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA><SFPGDATA><NAME>GV_SWITCH</NAME><TYPING>TYPE</TYPING><TYPENAME>BOOLEAN</TYPENAME><DEFAULTVAL/><CONSTANT/></SFPGDATA></GLOBAL_DATA><TYPES><FPCLINE>TYPES: BEGIN OF gty_data,</FPCLINE><FPCLINE>         tipo_doc         TYPE char20,</FPCLINE><FPCLINE>         serie            TYPE ymqaf01_el_userst2,</FPCLINE><FPCLINE>         numero           TYPE ymqaf01_el_userst3,</FPCLINE><FPCLINE>         no_autoriza      TYPE ymqaf01_el_userstr,</FPCLINE><FPCLINE>         fecha            TYPE ymqaf01_el_cdat,</FPCLINE><FPCLINE>         ref_interna      TYPE char30,</FPCLINE><FPCLINE>         text_reffac      TYPE char30,</FPCLINE><FPCLINE>         ref_factura      TYPE ymqaf01_el_userstr,</FPCLINE><FPCLINE>         text_refintfac   TYPE char30,</FPCLINE><FPCLINE>         ref_interna_fac  TYPE xblnr_v1,</FPCLINE><FPCLINE>         text_fech_fac    TYPE char20,</FPCLINE><FPCLINE>         fecha_fac        TYPE datum,</FPCLINE><FPCLINE>         nit              TYPE paval,</FPCLINE><FPCLINE>         vendedor         TYPE char100,</FPCLINE><FPCLINE>         dire_vendedor    TYPE char100,</FPCLINE><FPCLINE>         mail_vendedor    TYPE char50,</FPCLINE><FPCLINE>         nit_cliente      TYPE bptaxnum,</FPCLINE><FPCLINE>         cliente          TYPE char100,</FPCLINE><FPCLINE>         dire_cliente     TYPE char100,</FPCLINE><FPCLINE>         telefono_cliente TYPE char10,</FPCLINE><FPCLINE>         total_numero     TYPE p LENGTH 15 DECIMALS 2,</FPCLINE><FPCLINE>         gran_total       TYPE char15,</FPCLINE><FPCLINE>         total_letras     TYPE char100,</FPCLINE><FPCLINE>         descuento        TYPE kbetr,</FPCLINE><FPCLINE>         excento          TYPE kbetr,</FPCLINE><FPCLINE>         certificador     TYPE char50,</FPCLINE><FPCLINE>         nit_certificador TYPE char20,</FPCLINE><FPCLINE>         texto1           TYPE string,</FPCLINE><FPCLINE>         texto2           TYPE string,</FPCLINE><FPCLINE>         fimpresion       TYPE datum,</FPCLINE><FPCLINE>         himpresion       TYPE uzeit,</FPCLINE><FPCLINE>         asesor           TYPE char30,</FPCLINE><FPCLINE>         moneda           TYPE waerk,</FPCLINE><FPCLINE>       END OF gty_data.</FPCLINE><FPCLINE/><FPCLINE>TYPES: BEGIN OF gty_detalle,</FPCLINE><FPCLINE>         cantidad    TYPE kpein,</FPCLINE><FPCLINE>         producto    TYPE char100,</FPCLINE><FPCLINE>         precio_uni  TYPE p LENGTH 15 DECIMALS 2,</FPCLINE><FPCLINE>         prec_uni    TYPE char15,</FPCLINE><FPCLINE>         cprecio_uni TYPE char20,</FPCLINE><FPCLINE>         moneda      TYPE waerk,</FPCLINE><FPCLINE>         total       TYPE p LENGTH 15 DECIMALS 2,</FPCLINE><FPCLINE>         tot         TYPE char15,</FPCLINE><FPCLINE>         ctotal      TYPE char20,</FPCLINE><FPCLINE>       END OF gty_detalle.</FPCLINE><FPCLINE/><FPCLINE>TYPES: gtt_detalle TYPE TABLE OF gty_detalle.</FPCLINE></TYPES><FIELDSYMBOLS/></CL_FP_GLOBAL_DEFINITIONS></cls:CL_FP_GLOBAL_DEFINITIONS><cls:CL_FP_PARAMETERS id="o3579"><CL_FP_INTERFACE_DATA_CHANGED classVersion="1"><INTERFACE_DATA href="#o3582"/></CL_FP_INTERFACE_DATA_CHANGED><CL_FP_PARAMETERS classVersion="1"><IMPORT_PARAMETERS><SFPIOPAR><NAME>BIL_PRT_COM</NAME><TYPING>TYPE</TYPING><TYPENAME>INVOICE_S_PRT_INTERFACE</TYPENAME><OPTIONAL/><BYVALUE/><DEFAULTVAL/><STANDARD/><CONSTANT/></SFPIOPAR></IMPORT_PARAMETERS><EXPORT_PARAMETERS/><TABLE_PARAMETERS/><EXCEPTIONS/></CL_FP_PARAMETERS></cls:CL_FP_PARAMETERS><cls:CL_FP_CODING id="o3578"><CL_FP_INTERFACE_DATA_CHANGED classVersion="1"><INTERFACE_DATA href="#o3582"/></CL_FP_INTERFACE_DATA_CHANGED><CL_FP_CODING classVersion="1"><INPUT_PARAMETERS><FPPARAMETER>BIL_PRT_COM</FPPARAMETER></INPUT_PARAMETERS><OUTPUT_PARAMETERS><FPPARAMETER>GV_OCULTAR_IVA</FPPARAMETER><FPPARAMETER>GV_ITP</FPPARAMETER><FPPARAMETER>GV_SIN_IVA</FPPARAMETER><FPPARAMETER>GV_IVA</FPPARAMETER><FPPARAMETER>GV_FACAM</FPPARAMETER><FPPARAMETER>GS_DATA</FPPARAMETER><FPPARAMETER>GV_LOGO</FPPARAMETER><FPPARAMETER>GT_DETALLE</FPPARAMETER></OUTPUT_PARAMETERS><INITIALIZATION><FPCLINE>* Check the Segmentation switch</FPCLINE><FPCLINE>CALL METHOD cl_ops_switch_check=&gt;sfsw_segmentation</FPCLINE><FPCLINE>  RECEIVING</FPCLINE><FPCLINE>    rv_active = gv_switch.</FPCLINE><FPCLINE>IF gv_switch NE 'X'.</FPCLINE><FPCLINE>  CLEAR gv_switch.</FPCLINE><FPCLINE>ENDIF.</FPCLINE><FPCLINE/><FPCLINE>*CLEAR gv_switch.</FPCLINE><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_document)</FPCLINE><FPCLINE>  FROM i_billingdocument</FPCLINE><FPCLINE> WHERE billingdocument = @bil_prt_com-head_detail-vbdkr-vbeln.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_data)</FPCLINE><FPCLINE>  FROM zdistelsa_mon_cds_01</FPCLINE><FPCLINE> WHERE documento = @bil_prt_com-head_detail-vbdkr-vbeln.</FPCLINE><FPCLINE/><FPCLINE>CONCATENATE 'ZLOGO_' ls_data-vkorg INTO gv_name.</FPCLINE><FPCLINE>IF ls_data-vkorg = '1010'.</FPCLINE><FPCLINE>  IF ls_data-vtweg = '01' OR ls_data-vtweg = '03'.</FPCLINE><FPCLINE>    CONCATENATE gv_name ls_data-vtweg INTO gv_name SEPARATED BY '_'.</FPCLINE><FPCLINE>  ENDIF.</FPCLINE><FPCLINE>ENDIF.</FPCLINE><FPCLINE/><FPCLINE>CALL METHOD cl_ssf_xsf_utilities=&gt;get_bds_graphic_as_bmp</FPCLINE><FPCLINE>  EXPORTING</FPCLINE><FPCLINE>    p_object       = gv_object    "‘GRAPHICS’</FPCLINE><FPCLINE>    p_name         = gv_name      " Name of the SE78 logo inside Quotes</FPCLINE><FPCLINE>    p_id           = gv_id        " ‘BMAP’</FPCLINE><FPCLINE>    p_btype        = gv_btype     " ‘BCOL’ for color, ‘BMON’ for Black &amp; White</FPCLINE><FPCLINE>  RECEIVING</FPCLINE><FPCLINE>    p_bmp          = gv_logo      " v_field and g_logo must be typed xstring</FPCLINE><FPCLINE>  EXCEPTIONS</FPCLINE><FPCLINE>    not_found      = 1</FPCLINE><FPCLINE>    internal_error = 2</FPCLINE><FPCLINE>    OTHERS         = 3.</FPCLINE><FPCLINE/><FPCLINE>IF ls_document-sddocumentcategory = 'M'.</FPCLINE><FPCLINE>  gs_data-tipo_doc = 'FACTURA'.</FPCLINE><FPCLINE>  gs_data-texto1 = 'No se aceptan cambio o anulación de factura despues de 60 dias de emitida.'.</FPCLINE><FPCLINE>  gs_data-texto2 = 'Cualquier falla que presente un producto despues de 15 dias despues de la fecha de facturación debe reportarse al departamento de servicio técnico. Visite www.grupodistelsa.com para consultar puntos de servicio.'.</FPCLINE><FPCLINE>ELSEIF ls_document-sddocumentcategory = 'O'.</FPCLINE><FPCLINE>  IF ls_document-billingdocumenttype = 'ZABN'.</FPCLINE><FPCLINE>    gs_data-tipo_doc = 'NOTA DE ABONO'.</FPCLINE><FPCLINE>  ELSE.</FPCLINE><FPCLINE>    gs_data-tipo_doc = 'NOTA DE CRÉDITO'.</FPCLINE><FPCLINE>    gs_data-text_reffac = 'Referencia Factura:'.</FPCLINE><FPCLINE>    SELECT SINGLE *</FPCLINE><FPCLINE>      INTO @DATA(ls_ymqaf01_edvbrk)</FPCLINE><FPCLINE>      FROM ymqaf01_edvbrk</FPCLINE><FPCLINE>     WHERE vbeln = @bil_prt_com-head_detail-vbdkr-vbeln.</FPCLINE><FPCLINE/><FPCLINE>    gs_data-ref_factura = ls_ymqaf01_edvbrk-yuserstr01.</FPCLINE><FPCLINE>    gs_data-text_refintfac = 'Referencia Interna Factura:'.</FPCLINE><FPCLINE>    gs_data-ref_interna_fac = ls_document-assignmentreference.</FPCLINE><FPCLINE>    gs_data-text_fech_fac = 'Fecha Factura:'.</FPCLINE><FPCLINE>    SELECT SINGLE *</FPCLINE><FPCLINE>      INTO @DATA(ls_document2)</FPCLINE><FPCLINE>      FROM i_billingdocument</FPCLINE><FPCLINE>     WHERE billingdocument = @ls_document-assignmentreference.</FPCLINE><FPCLINE>    gs_data-fecha_fac = ls_document2-creationdate.</FPCLINE><FPCLINE>  ENDIF.</FPCLINE><FPCLINE>ENDIF.</FPCLINE><FPCLINE/><FPCLINE>gs_data-fimpresion = sy-datum.</FPCLINE><FPCLINE>gs_data-himpresion = sy-uzeit.</FPCLINE><FPCLINE/><FPCLINE>gs_data-serie = ls_data-yuserstr02.</FPCLINE><FPCLINE>gs_data-numero = ls_data-yuserstr03.</FPCLINE><FPCLINE>gs_data-no_autoriza = ls_data-yuserstr01.</FPCLINE><FPCLINE>gs_data-fecha = ls_data-cdate.</FPCLINE><FPCLINE>gs_data-ref_interna = ls_document-billingdocument.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_t001z)</FPCLINE><FPCLINE>  FROM t001z</FPCLINE><FPCLINE> WHERE bukrs = @ls_document-companycode.</FPCLINE><FPCLINE/><FPCLINE>gs_data-nit = ls_t001z-paval.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_t001)</FPCLINE><FPCLINE>  FROM t001</FPCLINE><FPCLINE> WHERE bukrs = @ls_document-companycode.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_adrc)</FPCLINE><FPCLINE>  FROM adrc</FPCLINE><FPCLINE> WHERE addrnumber = @ls_t001-adrnr.</FPCLINE><FPCLINE/><FPCLINE>CONCATENATE ls_adrc-name1 ls_adrc-name2 ls_adrc-name3 ls_adrc-name4 INTO gs_data-vendedor SEPARATED BY space.</FPCLINE><FPCLINE/><FPCLINE>CONCATENATE ls_adrc-street ls_adrc-city1 ls_adrc-post_code1 INTO gs_data-dire_vendedor SEPARATED BY space.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_dfkkbptaxnum)</FPCLINE><FPCLINE>  FROM dfkkbptaxnum</FPCLINE><FPCLINE> WHERE partner = @ls_document-payerparty.</FPCLINE><FPCLINE/><FPCLINE>gs_data-nit_cliente = ls_dfkkbptaxnum-taxnum.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_partner)</FPCLINE><FPCLINE>  FROM i_businesspartner</FPCLINE><FPCLINE> WHERE businesspartner = @ls_document-payerparty.</FPCLINE><FPCLINE/><FPCLINE>CONCATENATE "ls_partner-businesspartner</FPCLINE><FPCLINE>            ls_partner-organizationbpname1</FPCLINE><FPCLINE>            ls_partner-organizationbpname2</FPCLINE><FPCLINE>            ls_partner-organizationbpname3</FPCLINE><FPCLINE>            ls_partner-organizationbpname4</FPCLINE><FPCLINE>            INTO gs_data-cliente SEPARATED BY space.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_address)</FPCLINE><FPCLINE>  FROM i_buspartaddress</FPCLINE><FPCLINE> WHERE businesspartner = @ls_document-payerparty.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_cliente_adrc)</FPCLINE><FPCLINE>  FROM adrc</FPCLINE><FPCLINE> WHERE addrnumber = @ls_address-addressid.</FPCLINE><FPCLINE/><FPCLINE>CONCATENATE ls_cliente_adrc-street ls_cliente_adrc-city1 ls_cliente_adrc-post_code1 INTO gs_data-dire_cliente SEPARATED BY space.</FPCLINE><FPCLINE/><FPCLINE>SELECT *</FPCLINE><FPCLINE>  INTO TABLE @DATA(lt_items)</FPCLINE><FPCLINE>  FROM i_billingdocumentitem</FPCLINE><FPCLINE> WHERE billingdocument = @ls_document-billingdocument.</FPCLINE><FPCLINE/><FPCLINE>*BREAK MQA_ABAP3.</FPCLINE><FPCLINE>READ TABLE lt_items ASSIGNING FIELD-SYMBOL(&lt;fs_items&gt;) INDEX 1.</FPCLINE><FPCLINE>IF sy-subrc = 0.</FPCLINE><FPCLINE>  IF bil_prt_com-head_detail-vbdkr-fkart NE 'ZFVM'.</FPCLINE><FPCLINE>    CONCATENATE &lt;fs_items&gt;-salesoffice &lt;fs_items&gt;-distributionchannel gs_data-ref_interna INTO gs_data-ref_interna SEPARATED BY '-'.</FPCLINE><FPCLINE>  ELSE.</FPCLINE><FPCLINE>    gs_data-ref_interna = ls_ymqaf01_edvbrk-yuserstr05.</FPCLINE><FPCLINE>  ENDIF.</FPCLINE><FPCLINE>ENDIF.</FPCLINE><FPCLINE>gs_data-total_numero = 0.</FPCLINE><FPCLINE>LOOP AT lt_items ASSIGNING &lt;fs_items&gt;.</FPCLINE><FPCLINE>  APPEND INITIAL LINE TO gt_detalle ASSIGNING FIELD-SYMBOL(&lt;fs_detalle&gt;).</FPCLINE><FPCLINE>  IF SY-UNAME EQ 'MQA_ABAP3'.</FPCLINE><FPCLINE>    &lt;fs_detalle&gt;-cantidad = SY-TABIX.</FPCLINE><FPCLINE>    ELSE.</FPCLINE><FPCLINE>  &lt;fs_detalle&gt;-cantidad = &lt;fs_items&gt;-billingquantity.</FPCLINE><FPCLINE>  ENDIF.</FPCLINE><FPCLINE/><FPCLINE>  IF ls_data-vkorg = '1010'.</FPCLINE><FPCLINE>    IF ls_data-vtweg = '01' OR ls_data-vtweg = '03'.</FPCLINE><FPCLINE>      CONCATENATE '(' &lt;fs_items&gt;-material ')' INTO &lt;fs_detalle&gt;-producto.</FPCLINE><FPCLINE>      CONCATENATE &lt;fs_items&gt;-billingdocumentitemtext &lt;fs_detalle&gt;-producto INTO &lt;fs_detalle&gt;-producto SEPARATED BY space.</FPCLINE><FPCLINE>    ELSE.</FPCLINE><FPCLINE>      &lt;fs_detalle&gt;-producto  = &lt;fs_items&gt;-billingdocumentitemtext.</FPCLINE><FPCLINE>    ENDIF.</FPCLINE><FPCLINE>  ELSE.</FPCLINE><FPCLINE>    &lt;fs_detalle&gt;-producto  = &lt;fs_items&gt;-billingdocumentitemtext.</FPCLINE><FPCLINE>  ENDIF.</FPCLINE><FPCLINE>  IF  &lt;fs_items&gt;-billingquantity &lt;&gt; 0.</FPCLINE><FPCLINE>    &lt;fs_detalle&gt;-precio_uni = &lt;fs_items&gt;-subtotal3amount / &lt;fs_items&gt;-billingquantity ."&lt;fs_items&gt;-netamount + &lt;fs_items&gt;-taxamount.</FPCLINE><FPCLINE>  ENDIF.</FPCLINE><FPCLINE>  &lt;fs_detalle&gt;-prec_uni = &lt;fs_detalle&gt;-precio_uni.</FPCLINE><FPCLINE>  CONDENSE &lt;fs_detalle&gt;-prec_uni NO-GAPS.</FPCLINE><FPCLINE>  &lt;fs_detalle&gt;-moneda = &lt;fs_items&gt;-transactioncurrency.</FPCLINE><FPCLINE>  gs_data-moneda = &lt;fs_detalle&gt;-moneda.</FPCLINE><FPCLINE>  &lt;fs_detalle&gt;-total = &lt;fs_detalle&gt;-precio_uni *  &lt;fs_detalle&gt;-cantidad.</FPCLINE><FPCLINE>  &lt;fs_detalle&gt;-tot = &lt;fs_detalle&gt;-total.</FPCLINE><FPCLINE>  CONDENSE &lt;fs_detalle&gt;-tot NO-GAPS.</FPCLINE><FPCLINE>  &lt;fs_detalle&gt;-cprecio_uni = &lt;fs_detalle&gt;-precio_uni.</FPCLINE><FPCLINE>  &lt;fs_detalle&gt;-ctotal = &lt;fs_detalle&gt;-total.</FPCLINE><FPCLINE>*  IF &lt;fs_detalle&gt;-moneda = 'GTQ'.</FPCLINE><FPCLINE>*    CONCATENATE 'Q' &lt;fs_detalle&gt;-cprecio_uni INTO &lt;fs_detalle&gt;-cprecio_uni SEPARATED BY space.</FPCLINE><FPCLINE>*    CONCATENATE 'Q' &lt;fs_detalle&gt;-ctotal INTO &lt;fs_detalle&gt;-ctotal SEPARATED BY space.</FPCLINE><FPCLINE>*  ELSE.</FPCLINE><FPCLINE>*    CONCATENATE &lt;fs_detalle&gt;-moneda &lt;fs_detalle&gt;-cprecio_uni INTO &lt;fs_detalle&gt;-cprecio_uni SEPARATED BY space.</FPCLINE><FPCLINE>*    CONCATENATE &lt;fs_detalle&gt;-moneda &lt;fs_detalle&gt;-ctotal INTO &lt;fs_detalle&gt;-ctotal SEPARATED BY space.</FPCLINE><FPCLINE>*  ENDIF.</FPCLINE><FPCLINE>  gs_data-total_numero = gs_data-total_numero + &lt;fs_detalle&gt;-total.</FPCLINE><FPCLINE>ENDLOOP.</FPCLINE><FPCLINE/><FPCLINE>gs_data-gran_total = gs_data-total_numero.</FPCLINE><FPCLINE>CONDENSE gs_data-gran_total NO-GAPS.</FPCLINE><FPCLINE/><FPCLINE>DATA: ls_spell TYPE spell.</FPCLINE><FPCLINE/><FPCLINE>CALL FUNCTION 'SPELL_AMOUNT'</FPCLINE><FPCLINE>  EXPORTING</FPCLINE><FPCLINE>    amount    = gs_data-total_numero " Amount/Number to Be Spelled Out</FPCLINE><FPCLINE>    currency  = gs_data-moneda</FPCLINE><FPCLINE>    language  = sy-langu         " Language Indicator</FPCLINE><FPCLINE>  IMPORTING</FPCLINE><FPCLINE>    in_words  = ls_spell " Character String with Amount/Number Spelled Out</FPCLINE><FPCLINE>  EXCEPTIONS</FPCLINE><FPCLINE>    not_found = 1                " Argument Not Found in T015Z</FPCLINE><FPCLINE>    too_large = 2                " Amount Too Large to Be Spelled Out</FPCLINE><FPCLINE>    OTHERS    = 3.</FPCLINE><FPCLINE>IF sy-subrc &lt;&gt; 0.</FPCLINE><FPCLINE>ENDIF.</FPCLINE><FPCLINE/><FPCLINE/><FPCLINE>IF ls_document-transactioncurrency = 'GTQ'.</FPCLINE><FPCLINE>  CONCATENATE 'Total en quetzales:' ls_spell-word 'CON' ls_spell-decimal(2) '/100' INTO gs_data-total_letras SEPARATED BY space.</FPCLINE><FPCLINE>*  CONCATENATE 'Q' gs_data-total_numero INTO gs_data-total_numero SEPARATED BY space.</FPCLINE><FPCLINE>ELSEIF ls_document-transactioncurrency = 'USD'.</FPCLINE><FPCLINE>  CONCATENATE 'Total en dolares: ' ls_spell-word ' CON ' ls_spell-decimal(2) '/100' INTO gs_data-total_letras SEPARATED BY space.</FPCLINE><FPCLINE>*  CONCATENATE 'USD' gs_data-total_numero INTO gs_data-total_numero SEPARATED BY space.</FPCLINE><FPCLINE>ENDIF.</FPCLINE><FPCLINE/><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_vbpa)</FPCLINE><FPCLINE>  FROM vbpa</FPCLINE><FPCLINE> WHERE vbeln = @bil_prt_com-head_detail-vbdkr-vbeln</FPCLINE><FPCLINE>   AND parvw = 'VE'.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE *</FPCLINE><FPCLINE>  INTO @DATA(ls_but000)</FPCLINE><FPCLINE>  FROM but000</FPCLINE><FPCLINE> WHERE partner = @ls_vbpa-kunnr.</FPCLINE><FPCLINE/><FPCLINE>CONCATENATE ls_but000-name_first ls_but000-name_last INTO gs_data-asesor SEPARATED BY space.</FPCLINE><FPCLINE/><FPCLINE/><FPCLINE>SELECT SINGLE zval</FPCLINE><FPCLINE>  INTO @gs_data-certificador</FPCLINE><FPCLINE>  FROM ymqaf01_tc_bur01</FPCLINE><FPCLINE> WHERE bukrs = @ls_document-companycode</FPCLINE><FPCLINE>   AND name = 'PT_NOMBRE'.</FPCLINE><FPCLINE/><FPCLINE>SELECT SINGLE zval</FPCLINE><FPCLINE>INTO @gs_data-nit_certificador</FPCLINE><FPCLINE>FROM ymqaf01_tc_bur01</FPCLINE><FPCLINE>WHERE bukrs = @ls_document-companycode</FPCLINE><FPCLINE> AND name = 'PT_NIT'.</FPCLINE><FPCLINE/><FPCLINE/><FPCLINE>DATA: lv_facam TYPE char10.</FPCLINE><FPCLINE>CONCATENATE bil_prt_com-head_detail-vbdkr-fkart bil_prt_com-head_detail-vbdkr-zterm</FPCLINE><FPCLINE>INTO lv_facam SEPARATED BY '_'.</FPCLINE><FPCLINE/><FPCLINE>CASE bil_prt_com-head_detail-vbdkr-fkart.</FPCLINE><FPCLINE>  WHEN 'ZFVM'.</FPCLINE><FPCLINE>    IF bil_prt_com-head_detail-vbdkr-zterm NE 'Z000'.</FPCLINE><FPCLINE>      gv_facam = abap_true.</FPCLINE><FPCLINE>    ENDIF.</FPCLINE><FPCLINE>ENDCASE.</FPCLINE><FPCLINE/><FPCLINE>* Obtner Valor sin IVA.</FPCLINE><FPCLINE>SELECT SINGLE netwr FROM vbrk INTO gv_sin_iva</FPCLINE><FPCLINE>  WHERE vbeln EQ bil_prt_com-head_detail-vbdkr-vbeln.</FPCLINE><FPCLINE/><FPCLINE>* Obtner IVA, ITP.</FPCLINE><FPCLINE>SELECT * FROM prcd_elements</FPCLINE><FPCLINE>  WHERE knumv IN ( SELECT knumv</FPCLINE><FPCLINE>                     FROM vbrk</FPCLINE><FPCLINE>                     WHERE vbeln EQ @bil_prt_com-head_detail-vbdkr-vbeln )</FPCLINE><FPCLINE>  INTO TABLE @DATA(lt_elements).</FPCLINE><FPCLINE/><FPCLINE>LOOP AT lt_elements INTO DATA(ls_elements).</FPCLINE><FPCLINE>  CASE ls_elements-kschl.</FPCLINE><FPCLINE>    WHEN 'ZMWS'. "Suma IVA</FPCLINE><FPCLINE>      gv_iva = gv_iva + ls_elements-kwert.</FPCLINE><FPCLINE>    WHEN 'ZITF'. "Suma ITP</FPCLINE><FPCLINE>      gv_itp = gv_itp + ls_elements-kwert.</FPCLINE><FPCLINE>  ENDCASE.</FPCLINE><FPCLINE>ENDLOOP.</FPCLINE><FPCLINE/><FPCLINE>* Ocultar Filas de IVA</FPCLINE><FPCLINE>* Validacion en FormCal</FPCLINE><FPCLINE>CASE bil_prt_com-head_detail-vbdkr-vkorg.</FPCLINE><FPCLINE>  WHEN '1070'.</FPCLINE><FPCLINE>    gv_ocultar_iva = abap_false.</FPCLINE><FPCLINE>  WHEN OTHERS.</FPCLINE><FPCLINE>    gv_ocultar_iva = abap_true.</FPCLINE><FPCLINE>ENDCASE.</FPCLINE></INITIALIZATION><FORMS/></CL_FP_CODING></cls:CL_FP_CODING></asx:heap></asx:abap>